# JavaIO优化
## 性能检测
判断IO是否为瓶颈，可以从如下几个指标出发：
- IO wait指标 (iostat)，n个CPU，IO wait不应该超过1/n。
- IOPS
> 理论IOPS值计算如下：
> （磁盘数 X 每块磁盘的IOPS）/（磁盘读的吞吐量 + RAID因子 X 磁盘写的吞吐量）= IOPS

## 提升磁盘I/O性能
- 增加缓存，减少磁盘访问次数。
- 优化磁盘管理系统，底层操作系统层面，设计最优磁盘方式策略，以及磁盘寻址策略。
- 应用层面，设计合理磁盘存储数据块，以及访问数据块策略。例如：存放数据添加索引，通过寻址索引加快和减少磁盘访问量，通过异步和非阻塞方式加快磁盘访问速度。
- 应用合理的RAID策略提升磁盘I/O，RAID策略如下：<br>
![](/images/java/javaio-opt/javaio-opt-raid.PNG)

## 提升网络I/O性能
### 网络I/O优化
网络I/O优化基本处理原则：
- 减少网络交互次数。
> 网络交互两段设置缓存，数据库缓存；
> 合并访问请求，合并数据库查询请求/合并HTTP请求；

- 减少网络传输数据量大小
> 数据压缩/设计简单协议，读取协议头。

- 尽量减少编码
> 尽量用字节传输数据，减少从字符到字节转化过程。

此外，根据使用场景设计不同的交互方式（同步与异步、阻塞与非阻塞）：
1. 同步与异步，同步能保证任务可靠性，异步能提升性能，必须保持两者平衡。
   1. 同步，是可靠任务序列，一个任务完成需要依赖另外一个任务完成，任务状态一致；
   2. 异步，是不可靠任务序列，不需要等待被依赖任务完成，只是通知被依赖任务，主任务完成则完成，被依赖任务完成与否，无法确定；
3. 阻塞与非阻塞：
   1. 阻塞,就是CPU停下来等待一个慢操作完成以后，才接着工作；
   2. 非阻塞，就是这个慢操作执行时，CPU去做其他工作了，等这个慢操作完成了，CPU再接着后续操作。（提高CPU利用率的同时，增加线程切换）
4. 组合方式如下：<br>
   ![](/images/java/javaio-opt/javaio-opt-iotypes.PNG)

### TCP网络参数调优
调优参数如下：<br>
![](/images/java/javaio-opt/javaio-opt-tcp.PNG)<br>
![](/images/java/javaio-opt/javaio-opt-tcp2.PNG)

